{% extends 'layout.njk' %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/table/macro.njk" import govukTable %}
{% from "macros/vehicle-number-plate.njk" import vehicleNumberPlate %}
{% from "macros/trailer-number-plates.njk" import trailerNumberPlates %}
{% from "macros/gmr-search-result-mrn.njk" import gmrSearchResultMrn %}
{% from "macros/gmr-search-result-cds-status.njk" import gmrSearchResultCdsStatus %}

{% set pageTitle = "Showing result for " ~ searchTerm %}

{% set customsDeclarationsRows = [] %}
{% for linkedCustomsDeclaration in goodsVehicleMovement.linkedCustomsDeclarations %}
  {% set customsDeclarationsRows = (customsDeclarationsRows.push([{ html: gmrSearchResultMrn(linkedCustomsDeclaration) }, { html: gmrSearchResultCdsStatus(linkedCustomsDeclaration) }, { text: linkedCustomsDeclaration.btmsDecision }]), customsDeclarationsRows) %}
{% endfor %}

{% block content %}
  <div class="govuk-grid-row btms-gmr-search-result">
    <div class="govuk-grid-column-full">
      <h1 class="govuk-heading-l">
        <span class="govuk-caption-l">Showing result for</span>{{ searchTerm }}
      </h1>
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-three-quarters">
          <h2 class="govuk-heading-m">Vehicle details</h2>
          {{
            govukSummaryList({
              rows: [
                {
                  key: { text: 'Vehicle Registration Number (VRN)' },
                  value: { html: vehicleNumberPlate(goodsVehicleMovement.vehicleRegistrationNumber) }
                },
                {
                  key: { text: 'Trailer Registration Number (TRN)' },
                  value: { html: trailerNumberPlates(goodsVehicleMovement.trailerRegistrationNumbers) }
                }
              ]
            })
          }}
        </div>
      </div>

      <h3 class="govuk-heading-m">Linked customs declarations</h3>
      {{
        govukTable({
          caption: 'MRNs linked to this GMR and their CDS status',
          captionClasses: 'govuk-visually-hidden',
          head: [
            {
              text: 'MRN'
            },
            {
              text: 'CDS status'
            },
            {
              text: 'BTMS decision'
            }
          ],
          rows: customsDeclarationsRows
        })
      }}
    </div>
  </div>
{% endblock %}
